<div class="col-10 offset-2" align="center">
  <table id="chessboard">
    <% ((7).downto(0)).each do |y| %>
      <tr>
        <% (0..7).each do |x| %>
          <td class="square-td droppable" data-x="<%= x %>" data-y="<%= y %>">
            <% piece = Piece.find_by(x_position: x, y_position: y, game_id: @game.id) %>
            <div class="square<% if x % 2 == 0 && y % 2 == 1 || x % 2 == 1 && y % 2 == 0 %> light<% else %> dark<% end %>" data-id='<%= piece.id if piece %>'>
              <% if piece.present? %>
                <% image = find_piece(x, y) %>
                <%= image_tag(image, height: '65px', class: 'draggable').to_s if image %>
              <% end %>
            </div>
          </td>
        <% end %>
      </tr>
    <% end %>
  </table>
</div>

<script src="https://code.jquery.com/jquery-1.12.4.js"></script>
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
<script>
  $(document).ready(function () {
    $(".draggable").draggable();
    $(".droppable").droppable({

      drop: function( event, ui) {

        var id = ui.draggable.data('id')
        var x = $(this).data('x')
        var y = $(this).data('y')


        $.ajax({
          type: 'PUT',
           url: '/pieces/' + id,
           dataType: 'json',
           data: { id: id, x_position: x, y_position: y },
           success: function(data){
             location.reload();
          }
        });
      }
    });
  });
</script>
